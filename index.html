<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data from Google Sheets</title>
    <style>
        .container {
            max-width: 800px;
            margin: auto;
            text-align: center;
        }
        .dropdown, .sort-dropdown {
            margin: 20px;
            padding: 10px;
            font-size: 16px;
        }
        .student-data {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            text-align: left;
        }
        .sort-container {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Data from Google Sheets</h1>
        <select id="class-dropdown" class="dropdown">
            <option value="">Select a Class</option>
            <!-- Options will be populated dynamically -->
        </select>

        <div class="sort-container">
            <label for="sort-dropdown">Sort By:</label>
            <select id="sort-dropdown" class="sort-dropdown" disabled>
                <option value="name">Name</option>
                <option value="adnumber">Ad Number</option>
                <option value="score">Score</option>
            </select>
        </div>

        <div id="data-container"></div>
    </div>
    <script src="script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const classDropdown = document.getElementById("class-dropdown");
            const sortDropdown = document.getElementById("sort-dropdown");
            const container = document.getElementById("data-container");

            let studentData = []; // Store all student data here for sorting

            // Fetch data and populate class dropdown
            fetch("https://script.google.com/macros/s/AKfycbyFVRUjvnf3dj5uh0m6BCAiPCWHdmyxV9HvTjEfTB29LWAy7kC5vk96qPDFqwz1JlOK/exec")
                .then(response => response.json())
                .then(data => {
                    // Extract unique class names
                    const classNames = new Set();
                    for (const sheet in data) {
                        for (const student of Object.values(data[sheet])) {
                            classNames.add(student.class);
                            studentData.push(student); // Store all student data
                        }
                    }

                    // Populate the dropdown with unique class names
                    classNames.forEach(className => {
                        const option = document.createElement("option");
                        option.value = className;
                        option.textContent = className;
                        classDropdown.appendChild(option);
                    });

                    // Event listener for dropdown change
                    classDropdown.addEventListener("change", function() {
                        const selectedClass = this.value;
                        container.innerHTML = ""; // Clear previous data

                        // If a class is selected, display the relevant data
                        if (selectedClass) {
                            displayStudentData(selectedClass);
                            sortDropdown.disabled = false; // Enable sorting dropdown
                        } else {
                            sortDropdown.disabled = true; // Disable sorting dropdown
                        }
                    });

                    // Event listener for sorting
                    sortDropdown.addEventListener("change", function() {
                        const selectedClass = classDropdown.value;
                        displayStudentData(selectedClass); // Refresh data based on sort
                    });
                })
                .catch(error => {
                    console.error("Error fetching data: ", error);
                });

            // Function to display student data based on class and sorting
            function displayStudentData(selectedClass) {
                const selectedStudents = studentData.filter(student => student.class === selectedClass);

                // Sort students based on selected sort option
                const sortBy = sortDropdown.value;
                const sortedStudents = selectedStudents.sort((a, b) => {
                    if (sortBy === "name") {
                        return a.name.localeCompare(b.name);
                    } else if (sortBy === "adnumber") {
                        return a.adnumber - b.adnumber; // Assuming adnumber is a number
                    } else if (sortBy === "score") {
                        // If you want to sort by a specific score, adjust this part
                        return (a.score || 0) - (b.score || 0);
                    }
                    return 0;
                });

                // Display sorted students
                sortedStudents.forEach(student => {
                    const studentDiv = document.createElement("div");
                    studentDiv.classList.add("student-data");
                    studentDiv.innerHTML = `
                        <strong>Name:</strong> ${student.name} <br>
                        <strong>Ad Number:</strong> ${student.adnumber} <br>
                        <strong>Marks:</strong>
                        <ul>
                            ${Object.entries(student.exams).map(([exam, subjects]) => `
                                <li><strong>${exam}:</strong>
                                    <ul>
                                        ${Object.entries(subjects).map(([subject, marks]) => `
                                            <li>${subject} - TE: ${marks.te}, CE: ${marks.ce}, Max TE: ${marks.maxTE}, Max CE: ${marks.maxCE}</li>
                                        `).join('')}
                                    </ul>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    container.appendChild(studentDiv);
                });
            }
        });
    </script>
</body>
</html>
